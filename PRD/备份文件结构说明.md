# RoxyBrowser Manager 备份文件结构说明

## 概述

本文档详细说明 RoxyBrowser Manager 在备份和恢复用户配置时涉及的文件结构，供 Windows 版本开发时参考对比。

---

## 1. RoxyBrowser 数据目录

### macOS 路径
```
~/Library/Application Support/RoxyBrowser/
```

### Windows 实际路径
```
%APPDATA%\RoxyBrowser\
# 实际为: C:\Users\<用户名>\AppData\Roaming\RoxyBrowser\
```

---

## 2. 备份的文件/目录列表

代码定义 (`src-tauri/src/commands/profile.rs`):

```rust
const BACKUP_ITEMS: &[&str] = &[
    "config.json",          // RoxyBrowser 应用配置
    "Local Storage",        // 本地存储 (包含登录状态)
    "Cookies",              // Cookie 文件
    "Session Storage",      // 会话存储
    "IndexedDB",            // IndexedDB 数据库
];
```

### 详细说明

| 项目 | 类型 | 说明 | 跨平台兼容性 |
|------|------|------|-------------|
| `config.json` | 文件 | RoxyBrowser 应用配置（加密） | ⚠️ 可能不兼容 |
| `Local Storage/` | 目录 | LevelDB 格式的本地存储 | ⚠️ 需要测试 |
| `Cookies` | 文件 | SQLite Cookie 数据库 | ✅ 理论可兼容 |
| `Session Storage/` | 目录 | 会话数据 | ⚠️ 需要测试 |
| `IndexedDB/` | 目录 | 客户端数据库 | ❌ 可能不兼容 |

---

## 3. Local Storage 结构（关键）

```
Local Storage/
└── leveldb/
    ├── 000003.log      ← 主要数据文件（包含用户邮箱）
    ├── CURRENT
    ├── LOCK
    ├── LOG
    ├── LOG.old
    └── MANIFEST-000001
```

### 邮箱提取逻辑

从 `.log` 文件中搜索以下格式：
```json
{"token":"xxx","rememberMe":false,"password":"...","userInfo":{"email":"user@example.com"},"loginWay":"password"}
```

---

## 4. Roxy Manager 配置目录

### macOS
```
~/.roxy_manager/
├── config.json         ← 用户列表和当前用户配置
└── profiles/
    └── <用户邮箱>/
        ├── config.json
        ├── Local Storage/
        ├── Cookies
        ├── Session Storage/
        └── IndexedDB/
```

### Windows 实际
```
%USERPROFILE%\.roxy_manager\
```

---

## 5. config.json 结构（Roxy Manager）

```json
{
  "users": [
    {
      "email": "user@example.com",
      "display_name": "user",
      "created_at": "2026-01-23T00:00:00Z",
      "last_used": "2026-01-23T00:00:00Z"
    }
  ],
  "current_user": "user@example.com"
}
```

> **跨平台提示**：此 JSON 结构可以跨平台使用，只需在目标平台重新登录即可。

---

## 6. 导出包结构

执行"导出配置"后生成的目录：

```
roxy_manager_backup/
├── config.json         ← Roxy Manager 配置
└── profiles/
    └── <用户邮箱>/
        ├── config.json
        ├── Local Storage/
        ├── Cookies
        ├── Session Storage/
        └── IndexedDB/
```

---

## 7. 跨平台兼容性评估

| 数据类型 | 可直接迁移 | 说明 |
|----------|-----------|------|
| 用户列表 (config.json) | ✅ | 纯 JSON 格式 |
| Local Storage (LevelDB) | ⚠️ | 需测试二进制兼容性 |
| Cookies (SQLite) | ⚠️ | 需测试路径引用 |
| Session Storage | ❌ | 平台相关 |
| IndexedDB | ❌ | 平台相关，可能有路径硬编码 |

### 建议方案

如果需要跨平台迁移：

1. **仅迁移用户元数据**：只导出 `config.json` 中的用户列表
2. **在目标平台重新登录**：让 RoxyBrowser 重新生成本地配置

---

## 8. 测试步骤

请在 Windows 上执行以下对比：

1. 找到 RoxyBrowser 数据目录：
   ```cmd
   dir %LOCALAPPDATA%\RoxyBrowser
   ```

2. 对比是否存在相同的文件/目录：
   - [ ] config.json
   - [ ] Local Storage/
   - [ ] Cookies
   - [ ] Session Storage/
   - [ ] IndexedDB/

3. 检查 Local Storage 结构是否相同：
   ```cmd
   dir "%LOCALAPPDATA%\RoxyBrowser\Local Storage\leveldb"
   ```

4. 尝试用文本工具查看 `.log` 文件中是否有 `userInfo` 字段

请将对比结果反馈，我可以据此调整跨平台导入逻辑。
